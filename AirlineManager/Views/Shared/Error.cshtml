@{
	var statusCode = ViewData["StatusCode"] as int? ?? 500;
	var originalPath = ViewData["OriginalPath"] as string;
	var queryString = ViewData["QueryString"] as string;

	string title = "Error";
	string message = "An error occurred while processing your request.";
	string icon = "bi-exclamation-triangle-fill";
	string suggestion = "Please try again later or contact support if the problem persists.";

	switch (statusCode)
	{
		case 400:
			title = "Bad Request";
			message = "The request could not be understood by the server.";
			suggestion = "Please check your input and try again.";
			break;
		case 401:
			title = "Unauthorized";
			message = "You need to be logged in to access this resource.";
			icon = "bi-shield-lock-fill";
			suggestion = "Please log in to continue.";
			break;
		case 403:
			title = "Forbidden";
			message = "You don't have permission to access this resource.";
			icon = "bi-shield-exclamation";
			suggestion = "If you believe this is an error, please contact an administrator.";
			break;
		case 404:
			title = "Page Not Found";
			message = "The page you're looking for doesn't exist.";
			icon = "bi-search";
			suggestion = "The page may have been moved or deleted. Please check the URL or return to the home page.";
			break;
		case 405:
			title = "Method Not Allowed";
			message = "The request method is not supported for this resource.";
			suggestion = "Please try a different action.";
			break;
		case 408:
			title = "Request Timeout";
			message = "The server timed out waiting for the request.";
			icon = "bi-hourglass-split";
			suggestion = "Your connection may be slow. Please try again.";
			break;
		case 429:
			title = "Too Many Requests";
			message = "You've made too many requests in a short period.";
			icon = "bi-speedometer";
			suggestion = "Please wait a moment before trying again.";
			break;
		case 500:
			title = "Internal Server Error";
			message = "Something went wrong on our end.";
			suggestion = "Our team has been notified. Please try again later.";
			break;
		case 502:
			title = "Bad Gateway";
			message = "The server received an invalid response from an upstream server.";
			suggestion = "This is usually temporary. Please try again in a few moments.";
			break;
		case 503:
			title = "Service Unavailable";
			message = "The service is temporarily unavailable.";
			icon = "bi-tools";
			suggestion = "We may be performing maintenance. Please try again shortly.";
			break;
		case 504:
			title = "Gateway Timeout";
			message = "The server didn't receive a timely response from an upstream server.";
			icon = "bi-hourglass-split";
			suggestion = "Please try again in a few moments.";
			break;
	}

	ViewData["Title"] = $"{statusCode} - {title}";
}

@section Styles {
	<link rel="stylesheet" href="~/css/views/Shared/Error.css" asp-append-version="true" />
}

<div class="error-container">
	<div class="container py-5">
		<div class="row justify-content-center">
			<div class="col-lg-8 col-md-10">
				<!-- Error Card -->
				<div class="error-card card border-0 shadow-lg">
					<!-- Error Header -->
					<div class="error-header text-center py-5">
						<div class="error-icon-wrapper mb-4">
							<i class="bi @icon error-icon"></i>
						</div>
						<h1 class="error-code mb-2">@statusCode</h1>
						<h2 class="error-title mb-0">@title</h2>
					</div>

					<div class="card-body p-4 p-md-5">
						<!-- Error Message -->
						<div class="alert alert-light border rounded-3 mb-4">
							<p class="mb-0 text-center fs-5">
								@message
							</p>
						</div>

						<!-- Suggestion -->
						<div class="text-center mb-4">
							<p class="text-muted">
								<i class="bi bi-lightbulb me-2"></i>@suggestion
							</p>
						</div>

						<!-- Action Buttons -->
						<div class="d-grid gap-2 d-md-flex justify-content-md-center mb-4">
							@if (statusCode == 401)
							{
								<a asp-controller="Account" asp-action="Login" class="btn btn-primary btn-lg">
									<i class="bi bi-box-arrow-in-right me-2"></i>Log In
								</a>
							}
							else if (statusCode == 404)
							{
								<button onclick="history.back()" class="btn btn-outline-secondary btn-lg">
									<i class="bi bi-arrow-left me-2"></i>Go Back
								</button>
								<a asp-controller="Home" asp-action="Index" class="btn btn-primary btn-lg">
									<i class="bi bi-house-door me-2"></i>Home Page
								</a>
							}
							else
							{
								<button onclick="location.reload()" class="btn btn-primary btn-lg">
									<i class="bi bi-arrow-clockwise me-2"></i>Try Again
								</button>
								<a asp-controller="Home" asp-action="Index" class="btn btn-outline-secondary btn-lg">
									<i class="bi bi-house-door me-2"></i>Home Page
								</a>
							}
						</div>

						<!-- Divider -->
						<div class="position-relative mb-4">
							<hr class="text-muted" />
							<span class="position-absolute top-50 start-50 translate-middle bg-white px-3 text-muted small">
								Need Help?
							</span>
						</div>

						<!-- Help Links -->
						<div class="row g-3 text-center">
							<div class="col-md-4">
								<a asp-controller="Home" asp-action="Index" class="text-decoration-none">
									<div class="help-card p-3 rounded-3">
										<i class="bi bi-house-door-fill fs-3 text-primary mb-2"></i>
										<p class="mb-0 small fw-semibold">Home Page</p>
									</div>
								</a>
							</div>
							<div class="col-md-4">
								<a href="#" onclick="window.open('mailto:support@example.com','_blank'); return false;" class="text-decoration-none">
									<div class="help-card p-3 rounded-3">
										<i class="bi bi-envelope-fill fs-3 text-success mb-2"></i>
										<p class="mb-0 small fw-semibold">Contact Support</p>
									</div>
								</a>
							</div>
							<div class="col-md-4">
								<a href="#" onclick="searchSite(); return false;" class="text-decoration-none">
									<div class="help-card p-3 rounded-3">
										<i class="bi bi-search fs-3 text-info mb-2"></i>
										<p class="mb-0 small fw-semibold">Search Site</p>
									</div>
								</a>
							</div>
						</div>

						<!-- Debug Info (Only in Development) -->
						@if (Context.RequestServices.GetRequiredService<IWebHostEnvironment>().IsDevelopment())
						{
							<div class="mt-4">
								<div class="alert alert-warning border-0">
									<h6 class="alert-heading">
										<i class="bi bi-bug-fill me-2"></i>Debug Information (Development Mode Only)
									</h6>
									@if (!string.IsNullOrEmpty(originalPath))
									{
										<p class="mb-1"><strong>Original Path:</strong> <code>@originalPath</code></p>
									}
									@if (!string.IsNullOrEmpty(queryString))
									{
										<p class="mb-1"><strong>Query String:</strong> <code>@queryString</code></p>
									}
									<p class="mb-1"><strong>Status Code:</strong> <code>@statusCode</code></p>
									<p class="mb-0 small text-muted">
										This information is only visible in Development environment.
									</p>
								</div>
							</div>
						}
					</div>
				</div>

				<!-- Additional Info -->
				<div class="text-center mt-4">
					<p class="text-muted small">
						Error Code: <strong>@statusCode</strong> •
						<span id="currentTime"></span>
					</p>
				</div>
			</div>
		</div>
	</div>
</div>

@section Scripts {
	<script src="~/js/views/Shared/Error.js" asp-append-version="true"></script>
}
