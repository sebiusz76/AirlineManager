@model AirlineManager.Models.ViewModel.TwoFactorLoginViewModel

@{
	ViewData["Title"] = "Two-Factor Authentication";
}

<div class="auth-container">
	<div class="container py-5">
		<div class="row justify-content-center">
			<div class="col-lg-5 col-md-7">
				<!-- 2FA Card -->
				<div class="auth-card card border-0 shadow-lg">
					<!-- Header with gradient -->
					<div class="auth-header text-white text-center py-4" style="background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); border-radius: 15px 15px 0 0;">
						<div class="mb-3">
							<i class="bi bi-shield-lock" style="font-size: 3.5rem;"></i>
						</div>
						<h2 class="fw-bold mb-2">Two-Factor Authentication</h2>
						<p class="mb-0 opacity-75">Enter your authentication code</p>
					</div>

					<div class="card-body p-4 p-md-5">
						@if (TempData["ServerLog"] != null)
						{
							<div class="alert alert-warning rounded-3 mb-4">
								<i class="bi bi-exclamation-triangle me-2"></i>@TempData["ServerLog"]
							</div>
						}

						<div class="alert alert-info rounded-3 mb-4">
							<i class="bi bi-info-circle me-2"></i>
							<strong>Authenticator Code Required</strong>
							<p class="mb-0 mt-2 small">
								Open your authenticator app and enter the 6-digit code to continue.
							</p>
						</div>

						<form asp-action="LoginWith2fa" method="post">
							@Html.AntiForgeryToken()
							<div asp-validation-summary="ModelOnly" class="alert alert-danger rounded-3 mb-4"></div>

							<!-- 2FA Code Input -->
							<div class="mb-4">
								<label asp-for="TwoFactorCode" class="form-label fw-bold">
									<i class="bi bi-key me-2"></i>Authentication Code
								</label>
								<input asp-for="TwoFactorCode"
									   class="form-control form-control-lg text-center"
									   style="font-size: 1.5rem; letter-spacing: 0.5rem; font-family: monospace;"
									   placeholder="000000"
									   autocomplete="one-time-code"
									   maxlength="6"
									   autofocus />
								<span asp-validation-for="TwoFactorCode" class="text-danger small"></span>
								<small class="text-muted d-block mt-2">
									<i class="bi bi-clock me-1"></i>Codes expire after 30 seconds
								</small>
							</div>

							<!-- Remember Machine -->
							<div class="mb-4">
								<div class="form-check">
									<input asp-for="RememberMachine" class="form-check-input" type="checkbox" />
									<label asp-for="RememberMachine" class="form-check-label">
										Trust this device for 30 days
									</label>
								</div>
								<small class="text-muted d-block mt-1 ms-4">
									Don't check this on public or shared computers
								</small>
							</div>

							<input type="hidden" asp-for="ReturnUrl" />
							<input type="hidden" asp-for="RememberMe" />
							<input type="hidden" asp-for="UserId" />

							<!-- Verify Button -->
							<div class="d-grid gap-2 mb-4">
								<button type="submit" class="btn btn-lg text-white" style="background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);">
									<i class="bi bi-check-circle me-2"></i>Verify Code
								</button>
							</div>

							<!-- Divider -->
							<div class="position-relative mb-4">
								<hr class="text-muted" />
								<span class="position-absolute top-50 start-50 translate-middle bg-white px-3 text-muted small">
									Having trouble?
								</span>
							</div>

							<!-- Recovery Code Link -->
							<div class="text-center">
								<p class="text-muted mb-2">
									<i class="bi bi-life-preserver me-1"></i>
									Lost access to your authenticator app?
								</p>
								<a asp-action="LoginWithRecovery"
								   asp-route-returnUrl="@Model.ReturnUrl"
								   asp-route-userId="@Model.UserId"
								   class="text-decoration-none fw-bold">
									Use a Recovery Code <i class="bi bi-arrow-right"></i>
								</a>
							</div>
						</form>
					</div>
				</div>

				<!-- Back to Login -->
				<div class="text-center mt-4">
					<a asp-action="Login" class="text-decoration-none text-muted">
						<i class="bi bi-arrow-left me-1"></i>Back to Login
					</a>
				</div>
			</div>
		</div>
	</div>
</div>

<style>
	.auth-container {
		min-height: 100vh;
		background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
		display: flex;
		align-items: center;
		margin: -1rem -15px -60px;
		padding-bottom: 60px;
	}

	.auth-card {
		border-radius: 15px;
		overflow: hidden;
		animation: fadeInUp 0.6s ease-out;
	}

	@@keyframes fadeInUp {
		from {
			opacity: 0;
			transform: translateY(30px);
		}

		to {
			opacity: 1;
			transform: translateY(0);
		}
	}

	.form-control:focus {
		border-color: #2a5298;
		box-shadow: 0 0 0 0.25rem rgba(42, 82, 152, 0.25);
	}

	.form-check-input:checked {
		background-color: #2a5298;
		border-color: #2a5298;
	}

	.btn:hover {
		transform: translateY(-2px);
		box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
		transition: all 0.3s ease;
	}

	.alert {
		border-radius: 10px;
	}

	/* Code input animation */
	input[asp-for="TwoFactorCode"]:focus {
		animation: pulse 0.3s ease-in-out;
	}

	@@keyframes pulse {
		0%, 100% {
			transform: scale(1);
		}

		50% {
			transform: scale(1.02);
		}
	}
</style>

@section Scripts {
	<partial name="_ValidationScriptsPartial" />
	<script>
		// Auto-format 2FA code (add spaces for readability)
		document.querySelector('input[name="TwoFactorCode"]')?.addEventListener('input', function(e) {
			// Remove non-digits
			let value = e.target.value.replace(/\D/g, '');
			// Limit to 6 digits
			value = value.substring(0, 6);
			e.target.value = value;
		});

		// Auto-submit when 6 digits entered
		document.querySelector('input[name="TwoFactorCode"]')?.addEventListener('input', function(e) {
			if (e.target.value.length === 6) {
				// Optional: auto-submit after a short delay
				// setTimeout(() => e.target.form.submit(), 500);
			}
		});
	</script>
}
